<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>user form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col">
                <form>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email address</label>
                        <input type="email" class="form-control" id="email" onkeyup="validate()">
                    </div>
                    <div class="mb-3">
                        <label for="firstName" class="form-label">firstName</label>
                        <input type="text" class="form-control" id="firstName" onkeyup="validate()">
                    </div>
                    <div class="mb-3">
                        <label for="userName" class="form-label">userName</label>
                        <input type="text" class="form-control" id="userName" onkeyup="validate()">
                    </div>
                    <button type="button" class="btn btn-primary" disabled="true">Submit</button>
                </form>

            </div>
            <div class="col">
                <table class="table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>email</th>
                            <th>firstName</th>
                            <th>userName</th>
                            <th>Edit</th>
                            <th>Delete</th>

                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>

        </div>

    </div>

    <script>
        var all = [];
        var all = JSON.parse(localStorage.getItem("akhil"));

        // function for the submit button for creating 
        document.querySelector("button").onclick = (() => {
            var employee = {
                email: "",
                firstName: "",
                userName: "",
            }
            for (a in employee) {
                employee[a] = document.getElementById(a).value
            }
            // creating a copy 
            // var newemployee = object.assign({} ,employee )
            all.push({...employee})
            console.log(all);
            
            var allHere = JSON.stringify(all)
            localStorage.setItem("akhil", allHere)
            clearForm();
            displayElements();
            validate();

        })
    //    displaying elemsnts 
    
    function displayElements() {
            // all = [];
            // var employee = {
            //     email: "",
            //     firstName: "",
            //     userName: "",
            // }
            // we have to clear the body before giving new value cause already enterd value is in table if we give new data, the previous  will be displayed with this new data also it means if we give two datas if will disply 3 datas 
           document.querySelector("tbody").innerHTML = "";
            all.forEach((employee, i) => {
                var myTr = document.createElement("tr");
                var indexId = document.createElement("td");
                indexId.innerHTML = i + 1;
                myTr.appendChild(indexId);
               
                for (a in employee) {
                    var myTd = document.createElement("td");
                    myTd.innerHTML = employee[a];                      
                    myTr.appendChild(myTd);
                  
                }
                document.querySelector("tbody").appendChild(myTr);
                // edit button
                var edited = document.createElement("td");
                var editBtn = document.createElement("button");
                editBtn.setAttribute("class", "btn-warning");
                editBtn.setAttribute("onclick", "editElement(" + i + ")")
                editBtn.innerHTML = 'edit';

                myTr.appendChild(edited)
                edited.appendChild(editBtn)

                //    delete button 
                var deleted = document.createElement("td");
                var deleteBtn = document.createElement("button");
                deleteBtn.setAttribute("class", "btn-danger");
                deleteBtn.setAttribute("onclick", "deleteElement(" + i + ")")
                deleteBtn.innerHTML = 'Delete';

                myTr.appendChild(deleted)
                deleted.appendChild(deleteBtn)

                document.querySelector("tbody").appendChild(myTr);
            });
           
        }
        displayElements();

        
// clear form funtion
        function clearForm() {
            var employee = {
                email: "",
                firstName: "",
                userName: "",
            }
// we can create a clone to stop the dowble displying of funtions 
            for (a in employee) {
                document.getElementById(a).value = ""
                // document.getElementById("firstName").value = ""
                // document.getElementById("userName").value = ""
            }
        }
        
        // validating the function of button 

        function validate() {
            var employee = {
                email: "",
                firstName: "",
                userName: "",
            }
            console.log("just clicked");
            var formvalid = true;
            for (a in employee) {
                let myPerson = document.getElementById(a).value;
                if (a !== "email") {
                    if (myPerson.length == 0) {
                        formvalid = false;
                    }
                } else {
                    var emailPattern = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                    if (!emailPattern.test(myPerson)) {
                        formvalid = false;
                    }
                }
                if (formvalid) {
                    document.querySelector("button").removeAttribute('disabled');
                } else {
                    document.querySelector("button").setAttribute('disabled', true);
                }
            }

        }

    </script>


</body>

</html>