<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <link rel="shortcut icon" href="#">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"> 
</head>
<body>
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">api12</span>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
        <div class="col-9">
            <table class="table">
                <thead>
                  <tr>
                    <th scope="col">id</th>
                    <th scope="col">name</th>
                    <th scope="col">username</th>
                    <th scope="col">email</th>
                    <th scope="col">address</th>
                    <th scope="col">phone</th>
                    <th scope="col">website</th>
                    <th scope="col">company</th>
 

                  


                  </tr>
                </thead>
                <tbody>
                  
                </tbody>
              </table>
        </div>
            <form>
                <div class="mb-3">
                  <label for="exampleInputEmail1" class="form-label">id</label>
                  <input type="number" class="form-control" id="id" aria-describedby="emailHelp">
                </div>
           
               
                  <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">name</label>
                    <input type="text" class="form-control" id="name" aria-describedby="emailHelp">
                  </div>  
                  
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">username</label>
                    <input type="text" class="form-control" id="username" aria-describedby="emailHelp">
                  </div>
                  <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">email</label>
                    <input type="text" class="form-control" id="email" aria-describedby="emailHelp">
                  </div>
                  <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">address</label>
                    <input type="text" class="form-control" id="address" aria-describedby="emailHelp">
                  </div>
                  <div class="mb-3">

                  <label for="exampleInputEmail1" class="form-label">phone</label>
                  <input type="text" class="form-control" id="phone" aria-describedby="emailHelp">
                </div>
                <div class="mb-3">
                  <label for="exampleInputEmail1" class="form-label">website</label>
                  <input type="text" class="form-control" id="website" aria-describedby="emailHelp">
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">company</label>
                    <input type="text" class="form-control" id="company" aria-describedby="emailHelp">
                  </div>
                 
               
                <button type="button" class="btn btn-primary" onclick="updatePerson()">Submit</button>
              </form>
        </div>
    </div>
  </div>
    <script>
     let API_URL = "http://localhost:3000/json6/";
    var jsonPlaceHolder = [];
function getUsers() {
return new Promise((success)=>{
  var getInfo = new XMLHttpRequest();
getInfo.onreadystatechange = function () {
  if (getInfo.readyState == 4 && getInfo.status == 200) {
    jsonPlaceHolder = JSON.parse(getInfo.response);
    console.log(jsonPlaceHolder);
success();
  }
};
getInfo.open("GET", API_URL);
getInfo.send();
})
}
async function handleGetAllUsers(){
  Text = await getUsers();
  display()
}
handleGetAllUsers()


function display() {
jsonPlaceHolder.forEach((person, i) => {
  var myTr = document.createElement("tr");

  for (a in person) {
    if (a !== "address" && a !== "geo" && a !== "company") {
        var myTd = document.createElement("td");
        myTd.innerHTML = person[a];
        myTr.appendChild(myTd);
      } 
      else if (a == "address") {
        var myTd = document.createElement("td");
        myTd.innerHTML = person[a].street;
        myTr.appendChild(myTd);
      } else if (a == "company") {
        var myTd = document.createElement("td");
        myTd.innerHTML = person[a].name;
        myTr.appendChild(myTd);
      }
    } 
  

  var EditTd = document.createElement("td");
  var editBtn = document.createElement("button");
  editBtn.innerHTML = "Edit";
  editBtn.setAttribute("class", "btn btn-warning");
  editBtn.setAttribute("onclick", "editPerson(" + i + ")");
  EditTd.appendChild(editBtn);
  myTr.appendChild(EditTd);

  var deleteTd = document.createElement("td");
  var deleteBtn = document.createElement("button");
  deleteBtn.innerHTML = "Delete";
  deleteBtn.setAttribute("onclick", "deletePerson(" + i + ")");
  deleteBtn.setAttribute("class", "btn btn-danger");
  deleteTd.appendChild(deleteBtn);
  myTr.appendChild(deleteTd);

 document.querySelector("tbody").appendChild(myTr);
});
}



function editPerson(i) {
index = i;
for (a in jsonPlaceHolder[i]) {
  if (a !== "address" && a !== "geo" && a !== "company") {
 document.getElementById(a).value = jsonPlaceHolder[i][a];
  }
}
console.log(jsonPlaceHolder[i]);
}


function handleDelete(i){
    return new Promise((resolve)=>{
      var DEL_URL = API_URL + jsonPlaceHolder[i].id;
      var getInfo = new XMLHttpRequest();
      getInfo.onreadystatechange = function () {
        if (getInfo.readyState == 4 && getInfo.status == 200) {
          resolve()
        }
      };
      getInfo.open("DELETE", DEL_URL);
      getInfo.send();
    })
}

async function deletePerson(i) {
    let response = await handleDelete(i)
}

function handleUpdate(person){
  return new Promise((resolve)=>{
      let UPDATE_URL = API_URL+person.id
      var getInfo = new XMLHttpRequest();
      getInfo.onreadystatechange = function () {
        if (getInfo.readyState == 4 && getInfo.status == 200) {
          resolve()
        }
      };
      getInfo.open("PUT", UPDATE_URL);
      getInfo.setRequestHeader("Content-type","application/json")
      getInfo.send(JSON.stringify(person));
  })
}

async function updatePerson() {
  let person = { ...jsonPlaceHolder[index] };

  for (a in person) {
    if (a !== "address" && a !== "geo" && a !== "company") {

      person[a] = document.getElementById(a).value;
    
  }
}

  let response = await handleUpdate(person);
}      
   
  </script>
</body>
</html>